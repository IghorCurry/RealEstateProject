# 🚀 Детальний гід деплою Real Estate Project на Azure

## 🎯 Що ми робимо і чому це важливо

### Загальна картина

Ми розгортаємо ваш Real Estate проект в хмарі Azure, щоб він працював 24/7 і був доступний з будь-якого місця в світі. Це як "завантажити" ваш додаток в інтернет.

### Що включає ваш проект:

- **Backend API** (ASP.NET Core) - мозок додатку, обробляє запити
- **Frontend** (React) - обличчя додатку, що бачить користувач
- **База даних** (PostgreSQL) - сховище всіх даних
- **Автоматизація** - скрипт, який все налаштовує автоматично

---

## 🏗️ Архітектура деплою

### Схема того, що ми створюємо:

```
┌─────────────────────────────────────────────────────────────┐
│                    AZURE CLOUD                              │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐    ┌─────────────────┐                │
│  │   FRONTEND      │    │    BACKEND      │                │
│  │ Static Web App  │◄──►│  App Service    │                │
│  │   (React)       │    │  (ASP.NET Core) │                │
│  └─────────────────┘    └─────────────────┘                │
│           │                       │                        │
│           │                       ▼                        │
│           │              ┌─────────────────┐                │
│           │              │   DATABASE      │                │
│           │              │   PostgreSQL    │                │
│           │              │  Flexible Server│                │
│           │              └─────────────────┘                │
│           │                                                │
│           ▼                                                │
│  ┌─────────────────┐                                        │
│  │   USERS         │                                        │
│  │   (Browser)     │                                        │
│  └─────────────────┘                                        │
└─────────────────────────────────────────────────────────────┘
```

### Пояснення компонентів:

#### 1. **Static Web App (Frontend)**

- **Що це:** Хостинг для React додатку
- **Для чого:** Зберігає HTML, CSS, JavaScript файли
- **Як працює:** Користувач відкриває сайт → завантажується React → React робить запити до API

#### 2. **App Service (Backend)**

- **Що це:** Хостинг для ASP.NET Core API
- **Для чого:** Обробляє запити від фронтенду, виконує бізнес-логіку
- **Як працює:** Отримує HTTP запит → обробляє → повертає відповідь

#### 3. **PostgreSQL Database**

- **Що це:** Хмарна база даних
- **Для чого:** Зберігає всі дані (користувачі, нерухомість, запити)
- **Як працює:** Backend звертається до бази → зберігає/отримує дані

---

## 🔧 Чому нам потрібен скрипт деплою

### Проблема без скрипта:

Без автоматизації вам довелося б:

1. Створити 8+ ресурсів вручну через Azure Portal
2. Налаштувати кожен ресурс окремо
3. Завантажити код вручну
4. Налаштувати з'єднання між компонентами
5. Застосувати міграції бази даних
6. Налаштувати CORS та безпеку

**Це займе 2-3 години і багато помилок!**

### Рішення - автоматизований скрипт:

Скрипт робить все автоматично за 10-15 хвилин:

- ✅ Створює всі ресурси одним командою
- ✅ Налаштовує з'єднання між компонентами
- ✅ Деплоїть код автоматично
- ✅ Застосовує міграції
- ✅ Налаштовує безпеку

**Це як "кнопка" - натиснув і все готово!**

---

## 📋 Покрокова інструкція деплою

### КРОК 1: Підготовка середовища

#### 1.1 Встановлення Azure CLI

**Що робимо:** Встановлюємо інструмент для роботи з Azure
**Для чого:** Це як "пульт керування" для Azure - дозволяє створювати ресурси командами
**Як зробити:**

1. Відкрийте PowerShell як адміністратор
2. Виконайте команду:

```powershell
winget install Microsoft.AzureCLI
```

3. Перезапустіть PowerShell
4. Перевірте: `az --version`

**Пояснення:** Azure CLI - це програма, яка дозволяє керувати Azure ресурсами через командний рядок замість веб-інтерфейсу.

#### 1.2 Реєстрація в Azure

**Що робимо:** Створюємо акаунт в Azure
**Для чого:** Отримуємо доступ до хмарної інфраструктури Microsoft
**Як зробити:**

1. Перейдіть на https://portal.azure.com
2. Натисніть "Start free" (почати безкоштовно)
3. Введіть email та створіть пароль
4. Додайте платіжну інформацію (картку)
5. Підтвердіть email

**Пояснення:** Azure - це хмарна платформа Microsoft, де можна "орендувати" комп'ютери та сервіси в інтернеті.

### КРОК 2: Авторизація в Azure CLI

#### 2.1 Вхід в систему

**Що робимо:** Підключаємося до Azure через командний рядок
**Для чого:** Отримуємо дозвіл на створення ресурсів
**Як зробити:**

1. Відкрийте PowerShell
2. Виконайте команду:

```powershell
az login
```

3. Відкриється браузер - увійдіть в свій Azure акаунт
4. Поверніться в PowerShell

**Пояснення:** Це як "логін" в систему - після цього Azure знає, що це ви і дозволяє створювати ресурси.

### КРОК 3: Підготовка параметрів

#### 3.1 Створення унікальних назв

**Що робимо:** Підготуємо назви для ресурсів
**Для чого:** Кожен ресурс в Azure повинен мати унікальну назву
**Як зробити:**
Замініть `yourname` на ваше ім'я або унікальний ідентифікатор:

```powershell
$ResourceGroupName = "real-estate-rg"
$BackendAppName = "real-estate-api-yourname"  # Замініть yourname
$FrontendAppName = "real-estate-front-yourname"  # Замініть yourname
$DatabaseServerName = "real-estate-db-yourname"  # Замініть yourname
$DatabasePassword = "YourSecurePassword123!"  # Замініть на свій пароль
```

**Пояснення:** Azure - це величезна система, де мільйони користувачів створюють ресурси. Тому назви повинні бути унікальними, щоб не було конфліктів.

### КРОК 4: Запуск автоматизованого деплою

#### 4.1 Запуск скрипта

**Що робимо:** Запускаємо автоматизований скрипт
**Для чого:** Створюємо всі ресурси та деплоїмо код
**Як зробити:**

1. В PowerShell перейдіть в кореневу папку проекту
2. Виконайте команду:

```powershell
.\deploy-to-azure.ps1 -ResourceGroupName "real-estate-rg" -BackendAppName "real-estate-api-yourname" -FrontendAppName "real-estate-front-yourname" -DatabaseServerName "real-estate-db-yourname" -DatabasePassword "YourSecurePassword123!"
```

**Що відбувається під час виконання:**

1. **Створення Resource Group** (5 сек)

   - Створюється логічна група для організації ресурсів
   - Це як "папка" в Azure, де будуть всі ваші ресурси

2. **Створення PostgreSQL сервера** (5-10 хв)

   - Створюється сервер бази даних
   - Встановлюється PostgreSQL 13
   - Налаштовується безпека

3. **Створення бази даних** (30 сек)

   - Створюється конкретна база даних `real_estate`
   - Це як "файл" в базі даних

4. **Налаштування firewall** (30 сек)

   - Дозволяє підключення з Azure сервісів
   - Без цього backend не зможе підключитися до бази

5. **Створення App Service Plan** (2-3 хв)

   - Створюється план хостингу
   - Визначає ресурси (CPU, RAM) та вартість

6. **Створення Backend App Service** (3-5 хв)

   - Створюється контейнер для backend коду
   - Налаштовується .NET Core 8.0

7. **Налаштування змінних середовища** (30 сек)

   - Додається connection string до бази даних
   - Налаштовуються ключі для JWT токенів
   - Додаються налаштування адміністратора

8. **Створення Static Web App** (5-10 хв)

   - Створюється хостинг для React додатку
   - Налаштовується автоматичний білд

9. **Деплой Backend коду** (2-3 хв)

   - Компілюється ASP.NET Core проект
   - Створюється ZIP архів
   - Завантажується на Azure

10. **Застосування міграцій** (1-2 хв)
    - Створюються таблиці в базі даних
    - Додаються початкові дані

**Загальний час: 15-25 хвилин**

### КРОК 5: Налаштування CORS (КРИТИЧНО!)

#### 5.1 Чому це важливо

**Проблема:** Браузери блокуют запити між різними доменами з міркувань безпеки
**Рішення:** Налаштовуємо CORS (Cross-Origin Resource Sharing)

#### 5.2 Оновлення Program.cs

**Що робимо:** Додаємо Azure URL в CORS налаштування
**Для чого:** Дозволяємо фронтенду звертатися до backend
**Як зробити:**

1. Відкрийте файл `Backend/RealEstate/RealEstate.WebApi/Program.cs`
2. Знайдіть рядки 32-38 (CORS налаштування)
3. Додайте Azure URL:

```csharp
builder.Services.AddCors(options =>
{
    options.AddPolicy("AllowFrontend", policy =>
    {
        policy.WithOrigins(
            "http://localhost:5173",
            "http://localhost:5174",
            "http://localhost:3000",
            "https://real-estate-front-yourname.azurestaticapps.net" // Додайте цей рядок
        )
        .AllowAnyHeader()
        .AllowAnyMethod()
        .AllowCredentials();
    });
});
```

**Пояснення:** CORS - це механізм безпеки браузера. Коли фронтенд (наприклад, `https://frontend.azurestaticapps.net`) намагається звернутися до backend (`https://backend.azurewebsites.net`), браузер перевіряє, чи дозволено таке з'єднання. Без правильних CORS налаштувань браузер заблокує запит.

#### 5.3 Передеплой Backend

**Що робимо:** Заново деплоїмо backend з оновленими налаштуваннями
**Для чого:** Застосовуємо зміни CORS
**Як зробити:**

```powershell
cd Backend/RealEstate/RealEstate.WebApi
dotnet publish -c Release -o ./publish
Compress-Archive -Path "./publish/*" -DestinationPath "RealEstate.WebApi.zip" -Force
az webapp deployment source config-zip --resource-group "real-estate-rg" --name "real-estate-api-yourname" --src "RealEstate.WebApi.zip"
cd ../../..
```

**Пояснення:** Після зміни коду потрібно заново скомпілювати та завантажити його на сервер. Це як "оновлення" програми.

### КРОК 6: Тестування

#### 6.1 Перевірка Backend

**Що робимо:** Перевіряємо чи backend працює
**Для чого:** Переконуємося що API доступний
**Як зробити:**

1. Відкрийте браузер
2. Перейдіть за адресою: `https://real-estate-api-yourname.azurewebsites.net/swagger`
3. Ви повинні побачити Swagger UI з документацією API

**Пояснення:** Swagger - це інструмент, який автоматично створює документацію для API. Якщо він відкривається, значить backend працює правильно.

#### 6.2 Перевірка Frontend

**Що робимо:** Перевіряємо чи frontend працює
**Для чого:** Переконуємося що UI доступний
**Як зробити:**

1. Відкрийте браузер
2. Перейдіть за адресою: `https://real-estate-front-yourname.azurestaticapps.net`
3. Ви повинні побачити головну сторінку додатку

**Пояснення:** Static Web App - це сервіс Azure для хостингу статичних файлів (HTML, CSS, JS). Якщо сторінка завантажується, значить фронтенд працює.

#### 6.3 Тестування функціональності

**Що робимо:** Перевіряємо основні функції
**Для чого:** Переконуємося що все працює разом
**Як зробити:**

1. Натисніть "Register" та створіть тестовий акаунт
2. Увійдіть в систему
3. Спробуйте створити нове property
4. Перевірте список properties
5. Протестуйте фільтри

**Пояснення:** Це найважливіший тест - перевіряємо, чи фронтенд може спілкуватися з backend і чи backend може працювати з базою даних.

---

## 🔐 Безпека та конфігурація

### Connection String

**Що це:** Рядок підключення до бази даних
**Структура:**

```
Host=server.postgres.database.azure.com;
Database=real_estate;
Username=postgres@server;
Password=your-password;
SSL Mode=Require;
Trust Server Certificate=true;
```

**Пояснення:** Це як "адреса" бази даних. Backend використовує цей рядок, щоб знати, як підключитися до PostgreSQL.

### JWT Token Settings

**Що це:** Налаштування для автентифікації
**Компоненти:**

- `SigningKey`: Секретний ключ для підпису токенів
- `Issuer`: Хто видав токен
- `Audience`: Для кого призначений токен

**Пояснення:** JWT (JSON Web Token) - це спосіб безпечно передавати інформацію про користувача між фронтендом і backend. Це як "пропуск" користувача.

---

## 💰 Вартість та оптимізація

### Розбивка витрат:

| Ресурс               | План          | Вартість/місяць | Що включає        |
| -------------------- | ------------- | --------------- | ----------------- |
| App Service Plan     | B1            | ~$13            | 1 CPU, 1.75GB RAM |
| PostgreSQL           | Standard_B1ms | ~$25            | 1 vCore, 2GB RAM  |
| Static Web App       | Free          | $0              | 100GB трафік/міс  |
| Application Insights | Free          | $0              | 5GB даних/міс     |
| **Загалом**          |               | **~$38**        |                   |

### Оптимізація витрат:

1. **Використовуйте Free tier** де можливо
2. **Налаштуйте auto-shutdown** для dev environment
3. **Моніторте використання** ресурсів
4. **Використовуйте резервування** для довгострокових проектів

---

## 🚨 Критичні моменти та ризики

### 🔴 Критичні ризики:

1. **Втрата паролів**

   - **Ризик:** Доступ до бази даних
   - **Рішення:** Використовуйте Key Vault

2. **CORS помилки**

   - **Ризик:** Фронтенд не може звертатися до backend
   - **Рішення:** Правильно налаштувати CORS

3. **Connection string помилки**
   - **Ризик:** Backend не може підключитися до бази
   - **Рішення:** Перевірити SSL та firewall

### 🟡 Важливі ризики:

1. **Високе використання ресурсів**

   - **Ризик:** Збільшення витрат
   - **Рішення:** Моніторинг та алерти

2. **Втрата даних**
   - **Ризик:** Немає бек-апів
   - **Рішення:** Автоматичні бек-апи

---

## 🎯 Результат

Після успішного деплою у вас буде:

### Ваші URL:

- **🔗 Backend API:** `https://real-estate-api-yourname.azurewebsites.net`
- **🔗 Swagger UI:** `https://real-estate-api-yourname.azurewebsites.net/swagger`
- **🌐 Frontend:** `https://real-estate-front-yourname.azurestaticapps.net`
- **📊 Database:** `real-estate-db-yourname.postgres.database.azure.com`

### Що ви отримали:

1. **Повноцінний веб-додаток** в хмарі
2. **Професійна інфраструктура** з моніторингом
3. **Автоматизований деплой** через скрипт
4. **Масштабована архітектура** для росту
5. **Безпечна конфігурація** з шифруванням

### Наступні кроки:

1. **Додати SSL сертифікати**
2. **Налаштувати Key Vault**
3. **Додати CDN**
4. **Налаштувати алерти**
5. **Додати тестування**

**🎉 Ваш Real Estate проект готовий до продакшену!**

---

## 📞 Підтримка

Якщо у вас виникнуть питання або проблеми:

1. Перевірте логи в Azure Portal
2. Використовуйте Swagger для тестування API
3. Перевірте CORS налаштування
4. Звертайтеся за допомогою!

**Успіхів у деплої! 🚀**
