# Функціонал Favourite (Улюблені)

## Огляд

Функціонал Favourite дозволяє користувачам зберігати нерухомість в улюблені для подальшого перегляду. Користувачі можуть додавати проперті в улюблені, окрім тих, які вони самі створили.

## Основні можливості

### 1. Додавання в улюблені
- Користувачі можуть додавати будь-яку нерухомість в улюблені, крім своєї власної
- Кнопка улюблених (серце) відображається тільки для авторизованих користувачів
- Власники нерухомості не бачать кнопку улюблених для своїх проперті

### 2. Сторінка "Мої улюблені"
- Окрема сторінка `/favorites` для перегляду всіх улюблених
- Список відображається з використанням PropertyCard компонентів
- Можливість видалення з улюблених прямо з карток
- Автоматичне оновлення списку при видаленні

### 3. Індикатор кількості улюблених
- Badge з кількістю улюблених в навігації
- Відображається тільки для авторизованих користувачів
- При кліку перенаправляє на сторінку улюблених

## Технічна реалізація

### Компоненти

#### 1. PropertyCard
- Автоматична перевірка стану улюблених при завантаженні
- Індикатор завантаження при операціях з улюбленими
- Обробка помилок з поверненням попереднього стану
- Перевірка прав доступу (власники не можуть додавати свої проперті)

#### 2. FavoritesPage
- Використовує PropertyCard для відображення улюблених
- Інтеграція з хуком useFavorites
- Обробка станів завантаження та помилок
- Breadcrumbs та навігація

#### 3. FavoriteCount
- Компонент для відображення кількості улюблених
- Інтеграція з навігацією
- Tooltip з підказками

### Хуки

#### useFavorites
Централізований хук для управління станом улюблених:

```typescript
const {
  favorites,                    // Список улюблених
  isLoadingFavorites,          // Стан завантаження
  favoritesError,              // Помилки
  refetchFavorites,            // Функція оновлення
  addToFavorites,              // Додавання в улюблені
  removeFromFavorites,         // Видалення з улюблених
  toggleFavorite,              // Перемикання стану
  isFavorite,                  // Перевірка стану
  isAddingToFavorites,         // Стан додавання
  isRemovingFromFavorites,     // Стан видалення
} = useFavorites();
```

### Сервіси

#### favoriteService
API сервіс для роботи з улюбленими:

- `getUserFavorites()` - отримання улюблених користувача
- `addToFavorites(propertyId)` - додавання в улюблені
- `removeFromFavorites(propertyId)` - видалення з улюблених
- `isFavorite(propertyId)` - перевірка стану улюблених

### Кешування

Використовується React Query для кешування:
- `staleTime: 5 * 60 * 1000` (5 хвилин)
- `cacheTime: 10 * 60 * 1000` (10 хвилин)
- Автоматичне оновлення кешу при мутаціях

## Безпека

### Перевірки доступу
- Тільки авторизовані користувачі можуть додавати в улюблені
- Власники не можуть додавати свої проперті в улюблені
- Перевірка прав на сервері

### Валідація
- Перевірка існування проперті перед додаванням
- Обробка помилок з поверненням попереднього стану
- Валідація на клієнті та сервері

## UX/UI Особливості

### Індикатори стану
- Анімована кнопка улюблених
- Індикатор завантаження (CircularProgress)
- Toast повідомлення про успіх/помилку
- Hover ефекти та переходи

### Адаптивність
- Responsive дизайн для всіх розмірів екрану
- Оптимізація для мобільних пристроїв
- Правильне відображення на різних розмірах

### Доступність
- Tooltip підказки
- Правильні ARIA атрибути
- Клавіатурна навігація

## API Endpoints

```
GET /api/Favorite                    - Отримання улюблених користувача
POST /api/Favorite                   - Додавання в улюблені
DELETE /api/Favorite/{propertyId}    - Видалення з улюблених
GET /api/Favorite/check/{propertyId} - Перевірка стану улюблених
```

## Переклади

Підтримуються українська та англійська мови:

```typescript
// Англійська
"favorites.title": "My Favorites"
"favorites.add.success": "Added to favorites"
"favorites.remove.success": "Removed from favorites"

// Українська
"favorites.title": "Мої улюблені"
"favorites.add.success": "Додано до улюблених"
"favorites.remove.success": "Видалено з улюблених"
```

## Тестування

### Unit тести
- Тестування хука useFavorites
- Тестування компонентів PropertyCard, FavoritesPage
- Тестування сервісу favoriteService

### Integration тести
- Тестування взаємодії з API
- Тестування кешування
- Тестування навігації

### E2E тести
- Тестування повного flow додавання/видалення улюблених
- Тестування різних сценаріїв користувача

## Майбутні покращення

1. **Синхронізація** - синхронізація улюблених між пристроями
2. **Категорії** - можливість створювати категорії улюблених
3. **Експорт** - експорт списку улюблених
4. **Сповіщення** - сповіщення про зміни цін улюблених
5. **Порівняння** - можливість порівнювати улюблені проперті
