# Функціональність завантаження зображень для властивостей

## Огляд

Реалізована повна функціональність для управління зображеннями властивостей, що дозволяє користувачам:

- Завантажувати зображення під час створення нової властивості
- Додавати нові зображення до існуючої властивості
- Видаляти зображення з властивості
- Переглядати всі зображення властивості

## Технічна реалізація

### Бекенд

#### Моделі даних

- **PropertyCreateModel**: Додано поля `Images` (IFormFile) та `ImageUrls` (string)
- **PropertyUpdateModel**: Додано поле `ImagesToDelete` (List<Guid>)
- **PropertyImageViewModel**: Модель для відображення зображень
- **PropertyImageCreateModel**: Модель для створення зображень
- **PropertyImageUpdateModel**: Модель для оновлення зображень

#### API Ендпоінти

```
POST /api/property/{propertyId}/images - Завантаження зображень
DELETE /api/property/{propertyId}/images/{imageId} - Видалення зображення
PUT /api/property/{propertyId}/images/reorder - Зміна порядку зображень
GET /api/property/{propertyId}/images - Отримання зображень властивості
```

#### PropertyManager

Додано методи:

- `AddImageAsync()` - додавання нового зображення
- `DeleteImageAsync()` - видалення зображення
- `ReorderImagesAsync()` - зміна порядку зображень
- `GetPropertyImagesAsync()` - отримання всіх зображень

#### Файлове сховище

- Зображення зберігаються в `wwwroot/uploads/properties/`
- Унікальні імена файлів генеруються автоматично
- Підтримуються формати: JPG, JPEG, PNG, GIF, WebP
- Максимальний розмір файлу: 10MB

### Фронтенд

#### Типи

- **PropertyImage**: Інтерфейс для зображень з ID та URL
- **PropertyCreate**: Додано поля `images` (File[]) та `imageUrls` (string[])
- **PropertyUpdate**: Додано поле `imagesToDelete` (string[])

#### Компоненти

- **ImageUpload**: Універсальний компонент для завантаження зображень
  - Drag & Drop підтримка
  - Попередній перегляд зображень
  - Валідація типів та розмірів файлів
  - Можливість видалення зображень
  - Обмеження кількості зображень (за замовчуванням 10)

#### Сервіси

- **propertyService**: Додано методи для роботи з зображеннями
  - `uploadImages()` - завантаження зображень
  - `deleteImage()` - видалення зображення
  - `reorderImages()` - зміна порядку
  - `getPropertyImages()` - отримання зображень

## Використання

### Створення нової властивості з зображеннями

1. Заповніть основну інформацію про властивість
2. У розділі "Property Images" натисніть на область завантаження або перетягніть файли
3. Виберіть зображення (підтримуються JPG, PNG, GIF, WebP до 10MB)
4. Перегляньте попередній перегляд завантажених зображень
5. При необхідності видаліть непотрібні зображення
6. Натисніть "Create Property"

### Редагування властивості

1. Відкрийте форму редагування властивості
2. Існуючі зображення будуть автоматично завантажені
3. Додайте нові зображення або видаліть існуючі
4. Збережіть зміни

### Управління зображеннями

- **Додавання**: Клік на область завантаження або drag & drop
- **Видалення**: Клік на іконку видалення під зображенням
- **Перегляд**: Зображення відображаються в сітці з попереднім переглядом

## Валідація

### Типи файлів

- JPG/JPEG
- PNG
- GIF
- WebP

### Обмеження

- Максимальний розмір файлу: 10MB
- Максимальна кількість зображень: 10 (налаштовується)
- Мінімальний розмір файлу: 1KB

## Безпека

- Перевірка типів файлів на сервері
- Валідація розміру файлів
- Авторизація доступу до зображень
- Унікальні імена файлів для запобігання конфліктів
- Видалення фізичних файлів при видаленні записів

## Структура файлів

```
Backend/RealEstate/RealEstate.WebApi/
├── wwwroot/
│   └── uploads/
│       └── properties/
│           ├── {guid1}.jpg
│           ├── {guid2}.png
│           └── ...
```

## Налаштування

### Зміна максимальної кількості зображень

У компоненті `ImageUpload`:

```tsx
<ImageUpload
  images={images}
  onImagesChange={handleImagesChange}
  maxImages={15} // Змініть на потрібну кількість
/>
```

### Зміна максимального розміру файлу

У `PropertyManager.cs`:

```csharp
if (file.Length > 20 * 1024 * 1024) // 20MB замість 10MB
```

### Зміна шляху збереження

У `PropertyManager.cs`:

```csharp
private readonly string _uploadPath = "wwwroot/uploads/custom-path";
```

## Тестування

### Бекенд

1. Запустіть проект
2. Відкрийте Swagger UI
3. Протестуйте ендпоінти для роботи з зображеннями

### Фронтенд

1. Запустіть dev сервер: `pnpm dev`
2. Створіть нову властивість з зображеннями
3. Відредагуйте існуючу властивість
4. Перевірте відображення зображень

## Відомі обмеження

1. Зображення зберігаються локально (для продакшену рекомендується хмарне сховище)
2. Немає автоматичного зменшення розміру зображень
3. Немає підтримки водяних знаків
4. Порядок зображень не зберігається в базі даних

## Майбутні покращення

1. Інтеграція з хмарними сервісами (AWS S3, Azure Blob Storage)
2. Автоматичне зменшення розміру зображень
3. Додавання водяних знаків
4. Підтримка збереження порядку зображень
5. Галерія з повноекранним переглядом
6. Drag & Drop для зміни порядку зображень
